<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact | Reda</title>
    
    <link rel="stylesheet" href="css/contact.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/mobile.css">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>

    <div id="header"></div>       

    <div class="container">
        <span class="badge">Contact</span>
        <h1>On discute ?</h1>
        <p>Un projet, une question ou juste pour dire bonjour. Je te r√©ponds vite !</p>

        <form id="contact-form" class="contact-form">
            <div class="form-group">
                <label for="name">Ton Nom</label>
                <input type="text" id="name" required placeholder="Votre nom complet">
            </div>
            <div class="form-group">
                <label for="email">Ton Email</label>
                <input type="email" id="email" required placeholder="Example@gmail.com">
            </div>
            <div class="form-group">
                <label for="message">Ton Message</label>
                <textarea id="message" required placeholder="...."></textarea>
            </div>

            <div class="g-recaptcha" data-sitekey="6Lct424sAAAAAFRQuuubJsAHQ4WOuxDyMJaKnCIO" style="margin-bottom: 20px;"></div>

            <button type="submit" class="btn-submit">Envoyer le message üöÄ</button>
        </form>

        <p id="feedback"></p>

        <div class="button-container">
            <a href="index.html" class="btn-retour">‚Üê Retour √† l'accueil</a>
        </div>
    </div>

    <script>
      document.getElementById('contact-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const feedback = document.getElementById('feedback');
    // On r√©cup√®re le jeton au moment pr√©cis du clic
    const currentToken = grecaptcha.getResponse();

    if (!currentToken) {
        feedback.innerText = "Veuillez valider le captcha.";
        feedback.style.color = "#f87171";
        return;
    }

    const btn = document.querySelector('.btn-submit');
    btn.innerText = "Envoi en cours...";
    btn.disabled = true;

    try {
        const response = await fetch('/api/send-mail', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                message: document.getElementById('message').value,
                captchaToken: currentToken
            })
        });

        const result = await response.json();

        if (response.ok) {
            feedback.innerText = "Message envoy√© ! üöÄ";
            feedback.style.color = "#4ade80";
            this.reset();
            grecaptcha.reset(); // Tr√®s important pour pouvoir renvoyer un message
        } else {
            // Si Google dit que le token est invalide, on reset le captcha
            grecaptcha.reset();
            throw new Error(result.message);
        }
    } catch (error) {
        feedback.innerText = "Erreur : " + error.message;
        feedback.style.color = "#f87171";
    } finally {
        btn.innerText = "Envoyer le message üöÄ";
        btn.disabled = false;
    }
});
    </script>
    <script src="java/header.js"></script>
</body>
</html>